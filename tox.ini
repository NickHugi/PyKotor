[tox]
min_version = 4.0
env_list = 
    py38-{pyqt5,pyqt6,pyside2,pyside6}
    py39-{pyqt5,pyqt6,pyside2,pyside6}
    py310-{pyqt5,pyqt6,pyside2,pyside6}
    py311-{pyqt5,pyqt6,pyside6}  # pyside2 not supported on 3.11
    py312-{pyqt5,pyqt6,pyside6}
    py313-{pyqt5,pyqt6,pyside6}
    lint
    type
isolated_build = True

[testenv]
description = Run tests with {basepython} and {envname}
deps =
    pytest>=7.0
    pytest-qt>=4.2
    pytest-xvfb>=3.0  # For headless GUI testing
    pytest-cov>=4.1
    
    pyqt5: PyQt5>=5.15.2
    pyqt6: PyQt6>=6.6.1
    pyside2: PySide2>=5.15.2
    pyside6: PySide6>=6.6.3

setenv =
    pyqt5: QT_API=pyqt5
    pyqt6: QT_API=pyqt6
    pyside2: QT_API=pyside2
    pyside6: QT_API=pyside6
    PYTHONPATH = {toxinidir}
    PYTEST_QT_API = {env:QT_API}

commands =
    pytest {posargs:tests} --cov=pykotor --cov=holocrontoolset

[testenv:lint]
description = Run linting checks
deps =
    ruff>=0.1.6
    black>=23.11
commands =
    ruff check .
    black --check .

[testenv:type]
description = Run type checks
deps =
    mypy>=1.7
    types-setuptools
    types-requests
commands =
    mypy src tests

[pytest]
testpaths = tests
qt_api = {env:PYTEST_QT_API:pyqt5}
markers =
    gui: marks tests that require a GUI (deselect with '-m "not gui"')
    slow: marks tests that are slow (deselect with '-m "not slow"')
addopts = -ra -q
xvfb_width = 1920
xvfb_height = 1080
xvfb_colordepth = 24 